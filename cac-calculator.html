<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Lead Gen ROI Calculator - Findlay Subaru Prescott</title>
	<script>
		// Set theme immediately to prevent flash
		(function() {
			const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (prefersDark) {
				document.documentElement.setAttribute('data-theme', 'dark');
			} else {
				document.documentElement.setAttribute('data-theme', 'light');
			}
		})();
	</script>
	<style>
		:root {
			/* Light theme */
			--bg-primary: #f8f9fa;
			--bg-secondary: #ffffff;
			--bg-header: #3498db;
			--bg-card: #ffffff;
			--text-primary: #333333;
			--text-secondary: #555555;
			--text-light: #7f8c8d;
			--accent-primary: #3498db;
			--accent-success: #2ecc71;
			--accent-warning: #f39c12;
			--accent-danger: #e74c3c;
			--border-color: #e0e0e0;
			--shadow-color: rgba(0, 0, 0, 0.1);
		}

		[data-theme="dark"] {
			/* Dark theme */
			--bg-primary: #1a1a1a;
			--bg-secondary: #2d2d2d;
			--bg-header: #2c3e50;
			--bg-card: #2d2d2d;
			--text-primary: #e0e0e0;
			--text-secondary: #b0b0b0;
			--text-light: #888888;
			--accent-primary: #5dade2;
			--accent-success: #58d68d;
			--accent-warning: #f8b739;
			--accent-danger: #ec7063;
			--border-color: #404040;
			--shadow-color: rgba(0, 0, 0, 0.3);
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background-color: var(--bg-primary);
			color: var(--text-primary);
			line-height: 1.6;
			padding: 20px;
		}

		.container {
			max-width: 1400px;
			margin: 0 auto;
		}

		header {
			background: var(--bg-header);
			color: white;
			padding: 30px;
			border-radius: 10px;
			margin-bottom: 30px;
			text-align: center;
		}

		header h1 {
			font-size: 2em;
			margin-bottom: 10px;
		}

		header p {
			font-size: 1.1em;
			opacity: 0.9;
		}

		.theme-toggle {
			position: fixed;
			top: 20px;
			right: 20px;
			background: var(--bg-secondary);
			border: 2px solid var(--border-color);
			border-radius: 50%;
			width: 50px;
			height: 50px;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 1.5em;
			box-shadow: 0 2px 10px var(--shadow-color);
			transition: all 0.3s ease;
		}

		.theme-toggle:hover {
			transform: scale(1.1);
		}

		/* Profitability Setup Section */
		details.profitability-section {
			background: var(--bg-secondary);
			border: 2px solid var(--border-color);
			border-radius: 10px;
			padding: 20px;
			margin-bottom: 30px;
			box-shadow: 0 2px 10px var(--shadow-color);
		}

		details summary {
			cursor: pointer;
			font-weight: 600;
			font-size: 1.2em;
			color: var(--accent-primary);
			list-style: none;
			display: flex;
			align-items: center;
			gap: 10px;
		}

		details summary::-webkit-details-marker {
			display: none;
		}

		details summary::before {
			content: '‚ñ∂';
			display: inline-block;
			transition: transform 0.3s ease;
		}

		details[open] summary::before {
			transform: rotate(90deg);
		}

		.subtitle {
			font-size: 0.9em;
			color: var(--text-secondary);
			font-weight: normal;
			margin-left: auto;
		}

		.allowable-cost-display {
			background: linear-gradient(135deg, var(--accent-success) 0%, #27ae60 100%);
			color: white;
			padding: 20px;
			border-radius: 8px;
			margin-top: 20px;
			text-align: center;
		}

		.allowable-label {
			font-size: 1em;
			opacity: 0.95;
			margin-bottom: 5px;
		}

		.allowable-value {
			font-size: 2em;
			font-weight: 700;
		}

		/* Lead Funnel Section */
		.leadfunnel-section {
			background: var(--bg-secondary);
			border-radius: 10px;
			padding: 30px;
			margin-bottom: 30px;
			box-shadow: 0 2px 10px var(--shadow-color);
		}

		.section-title {
			font-size: 1.5em;
			color: var(--accent-primary);
			margin-bottom: 20px;
			padding-bottom: 10px;
			border-bottom: 2px solid var(--border-color);
		}

		.form-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
			gap: 20px;
		}

		.input-group {
			display: flex;
			flex-direction: column;
		}

		.input-group label {
			font-weight: 600;
			margin-bottom: 5px;
			color: var(--text-primary);
		}

		.input-group .description {
			font-size: 0.85em;
			color: var(--text-secondary);
			margin-bottom: 8px;
			line-height: 1.4;
		}

		.input-group input {
			padding: 12px;
			border: 2px solid var(--border-color);
			border-radius: 6px;
			font-size: 1em;
			background: var(--bg-primary);
			color: var(--text-primary);
			transition: border-color 0.3s ease;
		}

		.input-group input:focus {
			outline: none;
			border-color: var(--accent-primary);
		}

		.button-container {
			text-align: center;
			margin: 30px 0;
		}

		.button {
			padding: 15px 40px;
			font-size: 1.1em;
			font-weight: 600;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			transition: all 0.3s ease;
			box-shadow: 0 4px 15px var(--shadow-color);
		}

		.button.calculate {
			background: var(--accent-primary);
			color: white;
		}

		.button.calculate:hover {
			background: #2980b9;
			transform: translateY(-2px);
			box-shadow: 0 6px 20px var(--shadow-color);
		}

		/* Hero Section - Target CPL */
		.hero-section {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			padding: 50px;
			border-radius: 15px;
			margin-bottom: 30px;
			text-align: center;
			box-shadow: 0 10px 30px var(--shadow-color);
		}

		.hero-section h2 {
			font-size: 1.5em;
			margin-bottom: 20px;
			opacity: 0.95;
		}

		.target-cpl-display {
			font-size: 4em;
			font-weight: 700;
			margin-bottom: 30px;
			text-shadow: 0 2px 10px rgba(0,0,0,0.2);
		}

		.comparison-row {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 20px;
			margin-bottom: 30px;
			max-width: 600px;
			margin-left: auto;
			margin-right: auto;
		}

		.comparison-item {
			background: rgba(255,255,255,0.15);
			padding: 15px;
			border-radius: 8px;
			backdrop-filter: blur(10px);
		}

		.comparison-label {
			font-size: 0.9em;
			opacity: 0.9;
			margin-bottom: 5px;
		}

		.comparison-value {
			font-size: 2em;
			font-weight: 600;
		}

		.alert-box {
			background: rgba(255,255,255,0.2);
			padding: 20px;
			border-radius: 10px;
			margin-bottom: 20px;
			backdrop-filter: blur(10px);
		}

		.alert-box.success {
			border-left: 5px solid var(--accent-success);
		}

		.alert-box.warning {
			border-left: 5px solid var(--accent-warning);
		}

		.alert-box.danger {
			border-left: 5px solid var(--accent-danger);
		}

		.alert-title {
			font-size: 1.3em;
			font-weight: 600;
			margin-bottom: 10px;
		}

		.alert-message {
			font-size: 1.1em;
			line-height: 1.5;
		}

		.recommendations {
			background: rgba(255,255,255,0.15);
			padding: 20px;
			border-radius: 10px;
			text-align: left;
		}

		.recommendations h3 {
			margin-bottom: 15px;
			font-size: 1.2em;
		}

		.recommendations ul {
			list-style: none;
			padding-left: 0;
		}

		.recommendations li {
			padding: 8px 0;
			padding-left: 25px;
			position: relative;
		}

		.recommendations li::before {
			content: 'üí°';
			position: absolute;
			left: 0;
		}

		/* Results Grid */
		.results-section {
			margin-bottom: 30px;
		}

		.results-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
			gap: 20px;
			margin-top: 20px;
		}

		.result-card {
			background: var(--bg-card);
			border: 1px solid var(--border-color);
			border-radius: 10px;
			padding: 20px;
			box-shadow: 0 2px 10px var(--shadow-color);
			transition: transform 0.3s ease, box-shadow 0.3s ease;
		}

		.result-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 5px 20px var(--shadow-color);
		}

		.result-card.key-metric {
			border: 2px solid var(--accent-primary);
			background: linear-gradient(135deg, var(--bg-card) 0%, rgba(52, 152, 219, 0.05) 100%);
		}

		.metric-label {
			font-size: 0.9em;
			color: var(--text-secondary);
			margin-bottom: 10px;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			font-weight: 600;
		}

		.metric-value {
			font-size: 2.5em;
			font-weight: 700;
			color: var(--accent-primary);
			margin-bottom: 10px;
		}

		.metric-explanation {
			font-size: 0.85em;
			color: var(--text-secondary);
			line-height: 1.4;
		}

		/* Funnel Visualization */
		.funnel-viz-container {
			background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
			border-radius: 12px;
			padding: 30px;
			margin: 30px 0;
			box-shadow: 0 4px 15px var(--shadow-color);
		}

		[data-theme="dark"] .funnel-viz-container {
			background: linear-gradient(135deg, #2d2d2d 0%, #3a3a3a 100%);
		}

		.funnel-title {
			color: var(--accent-primary);
			font-size: 1.5em;
			font-weight: 600;
			margin-bottom: 25px;
			text-align: center;
		}

		.funnel-chart {
			display: flex;
			flex-direction: column;
			gap: 20px;
			max-width: 800px;
			margin: 0 auto;
		}

		.funnel-stage {
			display: flex;
			align-items: center;
			gap: 15px;
		}

		.funnel-label {
			min-width: 150px;
			font-weight: 600;
			color: var(--text-primary);
			font-size: 0.95em;
		}

		.funnel-bar-container {
			flex: 1;
		}

		.funnel-bar {
			height: 50px;
			background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
			border-radius: 8px;
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 0 15px;
			color: white;
			font-weight: 600;
			box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
			transition: all 0.3s ease;
			min-width: 100px;
		}

		.funnel-bar:hover {
			transform: translateX(5px);
			box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
		}

		.funnel-bar.final-stage {
			background: linear-gradient(90deg, #27ae60 0%, #229954 100%);
		}

		.funnel-count {
			font-size: 1.1em;
		}

		.funnel-rate {
			font-size: 0.9em;
			opacity: 0.9;
		}

		.funnel-arrow {
			text-align: center;
			color: var(--text-light);
			font-size: 1.5em;
			height: 20px;
		}

		/* Planning Tools */
		.planning-section {
			background: var(--bg-secondary);
			border-radius: 10px;
			padding: 30px;
			margin-bottom: 30px;
			box-shadow: 0 2px 10px var(--shadow-color);
		}

		.tool-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
			gap: 30px;
			margin-top: 20px;
		}

		.tool-card {
			background: var(--bg-primary);
			border: 2px solid var(--border-color);
			border-radius: 10px;
			padding: 25px;
		}

		.tool-title {
			font-size: 1.2em;
			color: var(--accent-primary);
			margin-bottom: 15px;
			font-weight: 600;
		}

		.tool-result {
			background: linear-gradient(135deg, var(--accent-primary) 0%, #2980b9 100%);
			color: white;
			padding: 20px;
			border-radius: 8px;
			margin-top: 15px;
			text-align: center;
		}

		.tool-result-value {
			font-size: 2em;
			font-weight: 700;
			margin-bottom: 5px;
		}

		.tool-result-label {
			font-size: 0.9em;
			opacity: 0.9;
		}

		/* Channel Comparison Table */
		.channel-table {
			width: 100%;
			border-collapse: collapse;
			margin-top: 20px;
		}

		.channel-table th {
			background: var(--accent-primary);
			color: white;
			padding: 12px;
			text-align: left;
			font-weight: 600;
		}

		.channel-table td {
			padding: 12px;
			border-bottom: 1px solid var(--border-color);
		}

		.channel-table tr:hover {
			background: var(--bg-primary);
		}

		.channel-table input {
			width: 80px;
			padding: 6px;
			border: 1px solid var(--border-color);
			border-radius: 4px;
			background: var(--bg-card);
			color: var(--text-primary);
		}

		.status-badge {
			padding: 4px 12px;
			border-radius: 20px;
			font-size: 0.85em;
			font-weight: 600;
			display: inline-block;
		}

		.status-badge.success {
			background: var(--accent-success);
			color: white;
		}

		.status-badge.warning {
			background: var(--accent-warning);
			color: white;
		}

		.status-badge.danger {
			background: var(--accent-danger);
			color: white;
		}

		.status-badge.target {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
		}

		/* Scenario Modeler */
		.scenario-grid {
			display: grid;
			gap: 20px;
			margin-top: 20px;
		}

		.scenario-card {
			background: var(--bg-primary);
			border: 2px solid var(--border-color);
			border-radius: 10px;
			padding: 20px;
		}

		.scenario-inputs {
			display: flex;
			gap: 15px;
			align-items: center;
			margin: 15px 0;
		}

		.scenario-inputs input {
			width: 100px;
			padding: 8px;
			border: 2px solid var(--border-color);
			border-radius: 6px;
			background: var(--bg-card);
			color: var(--text-primary);
			font-size: 1em;
		}

		.scenario-result {
			background: var(--bg-card);
			padding: 15px;
			border-radius: 8px;
			border-left: 4px solid var(--accent-primary);
			margin-top: 15px;
		}

		@media (max-width: 768px) {
			.form-grid {
				grid-template-columns: 1fr;
			}

			.results-grid {
				grid-template-columns: 1fr;
			}

			.tool-grid {
				grid-template-columns: 1fr;
			}

			.comparison-row {
				grid-template-columns: 1fr;
			}

			.target-cpl-display {
				font-size: 3em;
			}

			header h1 {
				font-size: 1.5em;
			}
		}
	</style>
</head>
<body>
	<div class="container">
		<button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
			<span id="themeIcon">üåô</span>
		</button>

		<header>
			<h1>üöó Lead Gen ROI Calculator</h1>
			<p>Findlay Subaru Prescott - Digital Marketing Command Center</p>
		</header>

		<form id="leadGenForm">
			<!-- Profitability Setup -->
			<details class="profitability-section" open>
				<summary>
					<span>‚öôÔ∏è Profitability Parameters</span>
					<span class="subtitle">Set once - Ask your GM/Sales Manager</span>
				</summary>
				<div class="form-grid">
					<div class="input-group">
						<label for="grossProfitPerSale">Gross Profit Per Vehicle Sale ($):</label>
						<div class="description">Total gross profit including front-end margin + F&I products (warranties, GAP, financing). Typical Subaru: $4,000-$6,000.</div>
						<input type="number" id="grossProfitPerSale" step="100" placeholder="e.g., 4800" value="4800">
					</div>
					<div class="input-group">
						<label for="marketingPercent">Acceptable Marketing Investment (%):</label>
						<div class="description">What % of gross profit can you spend on marketing? Typical: 20-30%. This determines your max cost per sale.</div>
						<input type="number" id="marketingPercent" step="1" placeholder="e.g., 25" value="25">
					</div>
				</div>
				<div class="allowable-cost-display">
					<div class="allowable-label">Your Allowable Cost Per Sale:</div>
					<div class="allowable-value">$<span id="allowableCostPerSale">1,200</span></div>
				</div>
			</details>

			<!-- Lead Funnel Inputs -->
			<div class="leadfunnel-section">
				<h3 class="section-title">üìä Your Lead Funnel</h3>
				<div class="form-grid">
					<div class="input-group">
						<label for="costPerLead">Cost Per Lead (CPL) ($):</label>
						<div class="description">Average cost to generate one qualified lead (all digital ad spend). Typical Subaru: $50-$90.</div>
						<input type="number" id="costPerLead" step="1" placeholder="e.g., 70" value="70">
					</div>
					<div class="input-group">
						<label for="monthlyLeadVolume">Monthly Lead Volume:</label>
						<div class="description">Total qualified leads per month across all sources (Google, Meta, third-party sites).</div>
						<input type="number" id="monthlyLeadVolume" step="10" placeholder="e.g., 280" value="280">
					</div>
					<div class="input-group">
						<label for="leadToApptRate">Lead-to-Appointment Rate (%):</label>
						<div class="description">% of leads that schedule a visit. Industry: 20-30%. Findlay's reputation suggests higher.</div>
						<input type="number" id="leadToApptRate" step="0.1" placeholder="e.g., 28.0" value="28">
					</div>
					<div class="input-group">
						<label for="apptShowRate">Appointment Show-Up Rate (%):</label>
						<div class="description">% of scheduled appointments where customer shows up. Industry: 60-75%.</div>
						<input type="number" id="apptShowRate" step="0.1" placeholder="e.g., 68.0" value="68">
					</div>
					<div class="input-group">
						<label for="closeRate">Showroom-to-Sale Conversion (%):</label>
						<div class="description">% of showroom visits that result in a sale. Subaru typical: 20-25%.</div>
						<input type="number" id="closeRate" step="0.1" placeholder="e.g., 23.0" value="23">
					</div>
				</div>
			</div>

			<div class="button-container">
				<button type="button" class="button calculate" onclick="calculate()">Calculate My Target CPL</button>
			</div>
		</form>

		<!-- Results Container -->
		<div id="results" style="display: none;">
			<!-- Hero Section - Target CPL -->
			<div class="hero-section" id="heroSection">
				<h2>üéØ YOUR TARGET CPL</h2>
				<div class="target-cpl-display">$<span id="targetCPL">0</span></div>

				<div class="comparison-row">
					<div class="comparison-item">
						<div class="comparison-label">Current CPL</div>
						<div class="comparison-value">$<span id="currentCPL">0</span></div>
					</div>
					<div class="comparison-item">
						<div class="comparison-label">Target CPL</div>
						<div class="comparison-value">$<span id="targetCPLRepeat">0</span></div>
					</div>
				</div>

				<div class="alert-box" id="alertBox">
					<div class="alert-title" id="alertTitle">Status</div>
					<div class="alert-message" id="alertMessage">Message</div>
				</div>

				<div class="recommendations">
					<h3>üí° TO FIX, EITHER:</h3>
					<ul id="recommendationsList">
						<li>Loading...</li>
					</ul>
				</div>
			</div>

			<!-- Lead Funnel Performance -->
			<div class="results-section">
				<h3 class="section-title">üìä Lead Funnel Performance</h3>
				<div class="results-grid">
					<div class="result-card">
						<div class="metric-label">Cost Per Lead</div>
						<div class="metric-value">$<span id="cplResult">0</span></div>
						<div class="metric-explanation">Your actual cost to generate one qualified lead.</div>
					</div>
					<div class="result-card key-metric">
						<div class="metric-label">Cost Per Appointment</div>
						<div class="metric-value">$<span id="cpaResult">0</span></div>
						<div class="metric-explanation">CPL √∑ Lead-to-Appointment Rate.</div>
					</div>
					<div class="result-card">
						<div class="metric-label">Cost Per Showroom Visit</div>
						<div class="metric-value">$<span id="cpvResult">0</span></div>
						<div class="metric-explanation">Cost for each customer who actually shows up.</div>
					</div>
					<div class="result-card key-metric">
						<div class="metric-label">Cost Per Sale</div>
						<div class="metric-value">$<span id="cpsResult">0</span></div>
						<div class="metric-explanation">Total marketing cost to close one sale.</div>
					</div>
					<div class="result-card">
						<div class="metric-label">Monthly Lead Volume</div>
						<div class="metric-value"><span id="leadVolumeResult">0</span></div>
						<div class="metric-explanation">Total qualified leads per month.</div>
					</div>
					<div class="result-card">
						<div class="metric-label">Monthly Appointments</div>
						<div class="metric-value"><span id="apptResult">0</span></div>
						<div class="metric-explanation">Leads √ó Lead-to-Appointment Rate.</div>
					</div>
					<div class="result-card">
						<div class="metric-label">Monthly Showroom Visits</div>
						<div class="metric-value"><span id="visitsResult">0</span></div>
						<div class="metric-explanation">Appointments √ó Show-Up Rate.</div>
					</div>
					<div class="result-card key-metric">
						<div class="metric-label">Monthly Vehicle Sales</div>
						<div class="metric-value"><span id="salesResult">0</span></div>
						<div class="metric-explanation">Showroom Visits √ó Close Rate.</div>
					</div>
					<div class="result-card">
						<div class="metric-label">Overall Lead-to-Sale Rate</div>
						<div class="metric-value"><span id="conversionResult">0</span>%</div>
						<div class="metric-explanation">% of leads that become sales. Industry: 2-5%.</div>
					</div>
					<div class="result-card">
						<div class="metric-label">Monthly Marketing Spend</div>
						<div class="metric-value">$<span id="spendResult">0</span></div>
						<div class="metric-explanation">Leads √ó CPL = Total ad spend.</div>
					</div>
					<div class="result-card">
						<div class="metric-label">Monthly Gross Profit</div>
						<div class="metric-value">$<span id="profitResult">0</span></div>
						<div class="metric-explanation">Sales √ó Gross Profit Per Sale.</div>
					</div>
					<div class="result-card key-metric">
						<div class="metric-label">Actual ROAS</div>
						<div class="metric-value"><span id="roasResult">0</span>x</div>
						<div class="metric-explanation">Gross Profit √∑ Marketing Spend.</div>
					</div>
				</div>
			</div>

			<!-- Funnel Visualization -->
			<div class="funnel-viz-container">
				<h3 class="funnel-title">üìä Lead-to-Sale Funnel Progression</h3>
				<div class="funnel-chart">
					<div class="funnel-stage">
						<div class="funnel-label">Monthly Leads</div>
						<div class="funnel-bar-container">
							<div class="funnel-bar" id="funnelLeadsBar" style="width: 100%;">
								<span class="funnel-count"><span id="funnelLeads">0</span> leads</span>
								<span class="funnel-rate">100%</span>
							</div>
						</div>
					</div>
					<div class="funnel-arrow">‚Üì</div>
					<div class="funnel-stage">
						<div class="funnel-label">Appointments</div>
						<div class="funnel-bar-container">
							<div class="funnel-bar" id="funnelApptBar">
								<span class="funnel-count"><span id="funnelAppt">0</span> appts</span>
								<span class="funnel-rate"><span id="funnelApptRate">0</span>%</span>
							</div>
						</div>
					</div>
					<div class="funnel-arrow">‚Üì</div>
					<div class="funnel-stage">
						<div class="funnel-label">Showroom Visits</div>
						<div class="funnel-bar-container">
							<div class="funnel-bar" id="funnelVisitsBar">
								<span class="funnel-count"><span id="funnelVisits">0</span> visits</span>
								<span class="funnel-rate"><span id="funnelVisitsRate">0</span>%</span>
							</div>
						</div>
					</div>
					<div class="funnel-arrow">‚Üì</div>
					<div class="funnel-stage">
						<div class="funnel-label">Vehicle Sales</div>
						<div class="funnel-bar-container">
							<div class="funnel-bar final-stage" id="funnelSalesBar">
								<span class="funnel-count"><span id="funnelSales">0</span> sales</span>
								<span class="funnel-rate"><span id="funnelSalesRate">0</span>%</span>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Planning Tools -->
			<div class="planning-section">
				<h3 class="section-title">üõ†Ô∏è Planning Tools</h3>

				<div class="tool-grid">
					<!-- Reverse Planning -->
					<div class="tool-card">
						<div class="tool-title">üìÖ Reverse Planning: Budget from Sales Target</div>
						<div class="input-group">
							<label for="targetSales">I need to sell this many vehicles next month:</label>
							<input type="number" id="targetSales" value="50" onchange="updateReversePlanning()">
						</div>
						<div class="tool-result">
							<div class="tool-result-label">You need</div>
							<div class="tool-result-value"><span id="requiredLeads">0</span> leads</div>
						</div>
						<div class="tool-result" style="margin-top: 10px;">
							<div class="tool-result-label">Budget Required (at current CPL)</div>
							<div class="tool-result-value">$<span id="requiredBudgetCurrent">0</span></div>
						</div>
						<div class="tool-result" style="margin-top: 10px; background: linear-gradient(135deg, var(--accent-success) 0%, #27ae60 100%);">
							<div class="tool-result-label">Budget Required (at target CPL)</div>
							<div class="tool-result-value">$<span id="requiredBudgetTarget">0</span></div>
							<div class="tool-result-label">Savings: $<span id="budgetSavings">0</span>/month</div>
						</div>
					</div>

					<!-- Scenario Modeler -->
					<div class="tool-card">
						<div class="tool-title">üîÆ What-If Scenario: Improve Close Rate</div>
						<div class="scenario-inputs">
							<span>What if close rate improved to:</span>
							<input type="number" id="scenarioCloseRate" value="25" step="0.1" onchange="updateScenario()">
							<span>%?</span>
						</div>
						<div class="scenario-result">
							<div><strong>New Target CPL:</strong> $<span id="scenarioTargetCPL">0</span></div>
							<div style="margin-top: 10px;"><span id="scenarioImpact">Impact calculation...</span></div>
						</div>

						<div class="tool-title" style="margin-top: 30px;">üí∞ What-If Scenario: Negotiate CPL</div>
						<div class="scenario-inputs">
							<span>What if I negotiate CPL to:</span>
							<input type="number" id="scenarioCPL" value="60" step="1" onchange="updateCPLScenario()">
							<span>$?</span>
						</div>
						<div class="scenario-result">
							<div><strong>New Cost Per Sale:</strong> $<span id="scenarioCPS">0</span></div>
							<div style="margin-top: 10px;"><span id="scenarioCPLImpact">Impact calculation...</span></div>
						</div>
					</div>
				</div>

				<!-- Channel Comparison -->
				<div style="margin-top: 30px;">
					<div class="tool-title">üìä Channel Performance Comparison</div>
					<p style="color: var(--text-secondary); margin-bottom: 15px;">Enter your CPL and lead-to-appointment rate for each channel to compare performance:</p>
					<table class="channel-table">
						<thead>
							<tr>
								<th>Channel</th>
								<th>CPL ($)</th>
								<th>Lead-to-Appt (%)</th>
								<th>Cost Per Sale</th>
								<th>Status</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td><strong>Google Ads</strong></td>
								<td><input type="number" id="googleCPL" value="65" onchange="updateChannelComparison()"></td>
								<td><input type="number" id="googleL2A" value="30" onchange="updateChannelComparison()"></td>
								<td>$<span id="googleCPS">0</span></td>
								<td><span id="googleStatus" class="status-badge">-</span></td>
							</tr>
							<tr>
								<td><strong>Meta Ads</strong></td>
								<td><input type="number" id="metaCPL" value="75" onchange="updateChannelComparison()"></td>
								<td><input type="number" id="metaL2A" value="25" onchange="updateChannelComparison()"></td>
								<td>$<span id="metaCPS">0</span></td>
								<td><span id="metaStatus" class="status-badge">-</span></td>
							</tr>
							<tr>
								<td><strong>Cars.com</strong></td>
								<td><input type="number" id="carsCPL" value="90" onchange="updateChannelComparison()"></td>
								<td><input type="number" id="carsL2A" value="35" onchange="updateChannelComparison()"></td>
								<td>$<span id="carsCPS">0</span></td>
								<td><span id="carsStatus" class="status-badge">-</span></td>
							</tr>
							<tr>
								<td><strong>Autotrader</strong></td>
								<td><input type="number" id="autotraderCPL" value="85" onchange="updateChannelComparison()"></td>
								<td><input type="number" id="autotraderL2A" value="28" onchange="updateChannelComparison()"></td>
								<td>$<span id="autotraderCPS">0</span></td>
								<td><span id="autotraderStatus" class="status-badge">-</span></td>
							</tr>
							<tr style="background: var(--bg-primary); font-weight: 600;">
								<td><strong>üéØ TARGET</strong></td>
								<td>$<span id="channelTargetCPL">0</span></td>
								<td><span id="channelTargetL2A">0</span>%</td>
								<td>$<span id="channelTargetCPS">0</span></td>
								<td><span class="status-badge target">üéØ Goal</span></td>
							</tr>
						</tbody>
					</table>
					<div id="channelInsight" style="margin-top: 15px; padding: 15px; background: var(--bg-primary); border-radius: 8px; border-left: 4px solid var(--accent-primary);"></div>
				</div>
			</div>
		</div>
	</div>

	<script>
		// Theme toggle
		function toggleTheme() {
			const html = document.documentElement;
			const currentTheme = html.getAttribute('data-theme');
			const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
			html.setAttribute('data-theme', newTheme);
			document.getElementById('themeIcon').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
		}

		// Set initial theme icon
		const currentTheme = document.documentElement.getAttribute('data-theme');
		document.getElementById('themeIcon').textContent = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

		// Update allowable cost per sale display
		document.getElementById('grossProfitPerSale').addEventListener('input', updateAllowableCost);
		document.getElementById('marketingPercent').addEventListener('input', updateAllowableCost);

		function updateAllowableCost() {
			const grossProfit = parseFloat(document.getElementById('grossProfitPerSale').value) || 0;
			const marketingPercent = parseFloat(document.getElementById('marketingPercent').value) / 100 || 0;
			const allowable = grossProfit * marketingPercent;
			document.getElementById('allowableCostPerSale').textContent = allowable.toFixed(0);
		}

		// Call on load
		updateAllowableCost();

		// Main calculation
		function calculate() {
			// Get profitability inputs
			const grossProfit = parseFloat(document.getElementById('grossProfitPerSale').value) || 0;
			const marketingPercent = parseFloat(document.getElementById('marketingPercent').value) / 100 || 0;

			// Get lead funnel inputs
			const cpl = parseFloat(document.getElementById('costPerLead').value) || 0;
			const leadVolume = parseFloat(document.getElementById('monthlyLeadVolume').value) || 0;
			const leadToAppt = parseFloat(document.getElementById('leadToApptRate').value) / 100 || 0;
			const showRate = parseFloat(document.getElementById('apptShowRate').value) / 100 || 0;
			const closeRate = parseFloat(document.getElementById('closeRate').value) / 100 || 0;

			// Calculate allowable cost per sale
			const allowableCostPerSale = grossProfit * marketingPercent;

			// Calculate overall conversion
			const overallConversion = leadToAppt * showRate * closeRate;

			// Calculate TARGET CPL
			const targetCPL = allowableCostPerSale * overallConversion;

			// Calculate funnel metrics
			const appointments = leadVolume * leadToAppt;
			const visits = appointments * showRate;
			const sales = visits * closeRate;

			// Calculate costs
			const cpa = leadToAppt > 0 ? cpl / leadToAppt : 0;
			const cpv = (leadToAppt * showRate) > 0 ? cpl / (leadToAppt * showRate) : 0;
			const cps = overallConversion > 0 ? cpl / overallConversion : 0;

			// Calculate spend and profit
			const monthlySpend = leadVolume * cpl;
			const monthlyProfit = sales * grossProfit;
			const roas = monthlySpend > 0 ? monthlyProfit / monthlySpend : 0;

			// Calculate difference
			const difference = cpl - targetCPL;
			const percentOver = (difference / targetCPL) * 100;

			// Update hero section
			document.getElementById('targetCPL').textContent = targetCPL.toFixed(2);
			document.getElementById('currentCPL').textContent = cpl.toFixed(0);
			document.getElementById('targetCPLRepeat').textContent = targetCPL.toFixed(2);

			// Update alert box
			const heroSection = document.getElementById('heroSection');
			const alertBox = document.getElementById('alertBox');
			const alertTitle = document.getElementById('alertTitle');
			const alertMessage = document.getElementById('alertMessage');
			const recommendationsList = document.getElementById('recommendationsList');

			if (cpl <= targetCPL) {
				alertBox.className = 'alert-box success';
				alertTitle.innerHTML = '‚úÖ HITTING TARGET';
				alertMessage.innerHTML = `You're spending <strong>$${Math.abs(difference).toFixed(2)}/lead UNDER target</strong>. Great job! You have room to increase spending or improve lead quality.`;
				recommendationsList.innerHTML = `
					<li>Consider increasing CPL to $${targetCPL.toFixed(2)} to capture more leads</li>
					<li>Invest the extra budget in premium ad placements</li>
					<li>Test expanding to new geographic areas or demographics</li>
				`;
			} else if (percentOver <= 15) {
				alertBox.className = 'alert-box warning';
				alertTitle.innerHTML = '‚ö†Ô∏è SLIGHTLY OVER TARGET';
				alertMessage.innerHTML = `You're spending <strong>$${difference.toFixed(2)}/lead over target</strong> (${percentOver.toFixed(1)}% above). Close to target - minor optimization needed.`;
				const requiredCloseRate = (allowableCostPerSale / cpl) / (leadToAppt * showRate);
				const currentCloseRatePercent = closeRate * 100;
				const requiredCloseRatePercent = requiredCloseRate * 100;
				const improvementNeeded = requiredCloseRatePercent - currentCloseRatePercent;
				recommendationsList.innerHTML = `
					<li>Reduce CPL from $${cpl} to <strong>$${targetCPL.toFixed(2)}</strong>, OR</li>
					<li>Improve close rate from ${currentCloseRatePercent.toFixed(1)}% to <strong>${requiredCloseRatePercent.toFixed(1)}%</strong> (+${improvementNeeded.toFixed(1)} percentage points)</li>
					<li>Focus on lead quality - are you attracting the right buyers?</li>
				`;
			} else {
				alertBox.className = 'alert-box danger';
				alertTitle.innerHTML = 'üî¥ OVERSPENDING';
				alertMessage.innerHTML = `You're spending <strong>$${difference.toFixed(2)}/lead over target</strong> (${percentOver.toFixed(1)}% above). Significant optimization needed to hit profitability goals.`;
				const requiredCloseRate = (allowableCostPerSale / cpl) / (leadToAppt * showRate);
				const currentCloseRatePercent = closeRate * 100;
				const requiredCloseRatePercent = requiredCloseRate * 100;
				const improvementNeeded = requiredCloseRatePercent - currentCloseRatePercent;
				recommendationsList.innerHTML = `
					<li>Reduce CPL from $${cpl} to <strong>$${targetCPL.toFixed(2)}</strong>, OR</li>
					<li>Improve close rate from ${currentCloseRatePercent.toFixed(1)}% to <strong>${requiredCloseRatePercent.toFixed(1)}%</strong> (+${improvementNeeded.toFixed(1)} percentage points)</li>
					<li>Review ad targeting - are leads qualified?</li>
					<li>Audit BDC process - are they setting quality appointments?</li>
					<li>Train sales team on closing techniques</li>
				`;
			}

			// Update performance metrics
			document.getElementById('cplResult').textContent = cpl.toFixed(0);
			document.getElementById('cpaResult').textContent = cpa.toFixed(0);
			document.getElementById('cpvResult').textContent = cpv.toFixed(0);
			document.getElementById('cpsResult').textContent = cps.toFixed(0);
			document.getElementById('leadVolumeResult').textContent = Math.round(leadVolume);
			document.getElementById('apptResult').textContent = Math.round(appointments);
			document.getElementById('visitsResult').textContent = Math.round(visits);
			document.getElementById('salesResult').textContent = Math.round(sales);
			document.getElementById('conversionResult').textContent = (overallConversion * 100).toFixed(2);
			document.getElementById('spendResult').textContent = monthlySpend.toFixed(0);
			document.getElementById('profitResult').textContent = monthlyProfit.toFixed(0);
			document.getElementById('roasResult').textContent = roas.toFixed(2);

			// Update funnel visualization
			document.getElementById('funnelLeads').textContent = Math.round(leadVolume);
			document.getElementById('funnelAppt').textContent = Math.round(appointments);
			document.getElementById('funnelVisits').textContent = Math.round(visits);
			document.getElementById('funnelSales').textContent = Math.round(sales);

			const apptPercent = (leadToAppt * 100);
			const visitsPercent = (leadToAppt * showRate * 100);
			const salesPercent = (overallConversion * 100);

			document.getElementById('funnelApptRate').textContent = apptPercent.toFixed(1);
			document.getElementById('funnelVisitsRate').textContent = visitsPercent.toFixed(1);
			document.getElementById('funnelSalesRate').textContent = salesPercent.toFixed(1);

			document.getElementById('funnelApptBar').style.width = apptPercent + '%';
			document.getElementById('funnelVisitsBar').style.width = visitsPercent + '%';
			document.getElementById('funnelSalesBar').style.width = salesPercent + '%';

			// Store calculations globally for planning tools
			window.calcData = {
				targetCPL,
				cpl,
				overallConversion,
				allowableCostPerSale,
				grossProfit,
				leadToAppt,
				showRate,
				closeRate,
				cps
			};

			// Update planning tools
			updateReversePlanning();
			updateScenario();
			updateCPLScenario();
			updateChannelComparison();

			// Show results
			document.getElementById('results').style.display = 'block';
			document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
		}

		// Reverse planning calculator
		function updateReversePlanning() {
			if (!window.calcData) return;

			const targetSales = parseFloat(document.getElementById('targetSales').value) || 0;
			const { overallConversion, cpl, targetCPL } = window.calcData;

			const requiredLeads = overallConversion > 0 ? targetSales / overallConversion : 0;
			const budgetCurrent = requiredLeads * cpl;
			const budgetTarget = requiredLeads * targetCPL;
			const savings = budgetCurrent - budgetTarget;

			document.getElementById('requiredLeads').textContent = Math.round(requiredLeads);
			document.getElementById('requiredBudgetCurrent').textContent = budgetCurrent.toFixed(0);
			document.getElementById('requiredBudgetTarget').textContent = budgetTarget.toFixed(0);
			document.getElementById('budgetSavings').textContent = savings.toFixed(0);
		}

		// Scenario modeler - close rate
		function updateScenario() {
			if (!window.calcData) return;

			const scenarioCloseRate = parseFloat(document.getElementById('scenarioCloseRate').value) / 100 || 0;
			const { allowableCostPerSale, leadToAppt, showRate, closeRate, cpl } = window.calcData;

			const newConversion = leadToAppt * showRate * scenarioCloseRate;
			const newTargetCPL = allowableCostPerSale * newConversion;
			const improvement = ((scenarioCloseRate - closeRate) / closeRate) * 100;

			document.getElementById('scenarioTargetCPL').textContent = newTargetCPL.toFixed(2);

			if (cpl <= newTargetCPL) {
				document.getElementById('scenarioImpact').innerHTML = `<span style="color: var(--accent-success);">‚úÖ This ${improvement.toFixed(1)}% improvement would bring you ON TARGET!</span>`;
			} else {
				const remaining = cpl - newTargetCPL;
				document.getElementById('scenarioImpact').innerHTML = `Still $${remaining.toFixed(2)}/lead over target. Need ${improvement.toFixed(1)}% close rate improvement + reduce CPL by $${remaining.toFixed(2)}.`;
			}
		}

		// Scenario modeler - CPL
		function updateCPLScenario() {
			if (!window.calcData) return;

			const scenarioCPL = parseFloat(document.getElementById('scenarioCPL').value) || 0;
			const { overallConversion, targetCPL, cpl } = window.calcData;

			const newCPS = overallConversion > 0 ? scenarioCPL / overallConversion : 0;
			const reduction = ((cpl - scenarioCPL) / cpl) * 100;
			const leadVolume = parseFloat(document.getElementById('monthlyLeadVolume').value) || 0;
			const monthlySavings = (cpl - scenarioCPL) * leadVolume;

			document.getElementById('scenarioCPS').textContent = newCPS.toFixed(0);

			if (scenarioCPL <= targetCPL) {
				document.getElementById('scenarioCPLImpact').innerHTML = `<span style="color: var(--accent-success);">‚úÖ This ${reduction.toFixed(1)}% CPL reduction hits target! Saves $${monthlySavings.toFixed(0)}/month.</span>`;
			} else {
				const remaining = scenarioCPL - targetCPL;
				document.getElementById('scenarioCPLImpact').innerHTML = `Still $${remaining.toFixed(2)}/lead over target. But saves $${monthlySavings.toFixed(0)}/month vs. current.`;
			}
		}

		// Channel comparison
		function updateChannelComparison() {
			if (!window.calcData) return;

			const { showRate, closeRate, targetCPL, allowableCostPerSale } = window.calcData;

			const channels = ['google', 'meta', 'cars', 'autotrader'];
			const channelData = [];

			channels.forEach(channel => {
				const cpl = parseFloat(document.getElementById(`${channel}CPL`).value) || 0;
				const l2a = parseFloat(document.getElementById(`${channel}L2A`).value) / 100 || 0;
				const conversion = l2a * showRate * closeRate;
				const cps = conversion > 0 ? cpl / conversion : 0;

				channelData.push({ channel, cpl, l2a: l2a * 100, cps });

				document.getElementById(`${channel}CPS`).textContent = cps.toFixed(0);

				// Status badge
				const statusEl = document.getElementById(`${channel}Status`);
				if (cps <= allowableCostPerSale) {
					statusEl.className = 'status-badge success';
					statusEl.textContent = '‚úÖ On Target';
				} else if (cps <= allowableCostPerSale * 1.15) {
					statusEl.className = 'status-badge warning';
					statusEl.textContent = '‚ö†Ô∏è Close';
				} else {
					statusEl.className = 'status-badge danger';
					statusEl.textContent = '‚ùå Over';
				}
			});

			// Update target row
			const avgL2A = parseFloat(document.getElementById('leadToApptRate').value);
			document.getElementById('channelTargetCPL').textContent = targetCPL.toFixed(2);
			document.getElementById('channelTargetL2A').textContent = avgL2A.toFixed(1);
			document.getElementById('channelTargetCPS').textContent = allowableCostPerSale.toFixed(0);

			// Generate insight
			channelData.sort((a, b) => a.cps - b.cps);
			const best = channelData[0];
			const worst = channelData[channelData.length - 1];

			const insightEl = document.getElementById('channelInsight');
			insightEl.innerHTML = `
				<strong>üí° INSIGHT:</strong>
				<strong>${best.channel.toUpperCase()}</strong> has the best ROI at $${best.cps.toFixed(0)} cost per sale.
				<strong>${worst.channel.toUpperCase()}</strong> is most expensive at $${worst.cps.toFixed(0)} per sale.
				${best.l2a > worst.l2a ? `${best.channel.toUpperCase()} also has higher quality leads (${best.l2a.toFixed(1)}% vs ${worst.l2a.toFixed(1)}% lead-to-appointment).` : ''}
				Consider shifting budget from ${worst.channel} to ${best.channel}.
			`;
		}
	</script>
</body>
</html>
